#summary Compiler CSSMatch

<wiki:toc max_depth="2" />
<br>

= Contribuer au projet CSSMatch =

CSSMatch est distribué sous [http://www.gnu.org/licenses/gpl.html licence GNU/GPLv3], ce qui en fait un plugin [http://fr.wikipedia.org/wiki/Logiciel_libre libre].

Toute personne souhaitant aider au développement de CSSMatch est la bienvenue. Vous êtes d'ailleurs libres de proposer vos patchs sur [http://code.google.com/p/cssmatch-plugin/issues/list le bug tracker]. Si vous souhaitez vous investir d'avantage, [mailto:dani31m@hotmail.com contactez moi], je vous donnerais alors les droits nécessaires pour gérer le bug tracker ou plus. La seule condition que j'exigerais de vous sera d'avoir une expérience acceptable du langage C++.

Que vous souhaitiez contribuer ou non, compiler soi-même un logiciel assure toujours une compatibilité maximale avec votre machine. Voici un tutoriel vous expliquant comment compiler CSSMatch.

<br>
= Compilation sur Linux =

== Les pré-requis ==
 * Une version 32 bits récente de votre distribution Linux favorite
 * Le logiciel "svn"
 * Le logiciel "make"
 * La version 4.1 du compilateur "gcc/g++"
 * Un serveur dédié CS:S (srcds)

== Préparation de la première compilation ==

====Avec un script shell====
 * Créez un nouveau dossier pour le projet
 * Placez-vous dans ce dossier, et places-y le script suivant : [http://www.cssmatch.com/temp/get_cssmatch.sh]
 * A l'aide d'un terminal, autorisez l'exécution du script
 {{{
chmod +x get_cssmatch.sh
}}}
 * Le script prend en paramètre le chemin vers le dossier d'installation de SRCDS. Par exemple :
 {{{
./get_cssmatch.sh ~/srcds
}}}
 Le script téléchargera alors pour vous le SDK du jeu et le code source de CSSMatch, puis créera un lien symbolique vers le dossier _srcds_/orangebox/bin

 _*Note :* Par défaut le script ira chercher la version code source de CSSMatch qui est en cours de développement (dossier *trunk* du SVN). Ce genre de choses (et d'autres !) peut être changé en modifiant la partie configuration du fichier *get_cssmatch.sh*._

====Sans script shell====
 * Créez un nouveau dossier pour le projet
 * A l'aide d'un terminal, placez-vous dans ce dossier
 * Récupérez le SDK des jeux _Source 2009 (alias Orange Box)_ compatible avec la version 4.1 de gcc : http://hg.alliedmods.net/hl2sdks/hl2sdk-ob-valve/archive/tip.tar.gz (38 MB)
 _*Note :* Décompressez le fichier dans un dossier nommé *hl2sdk-ob*._ 
 * Récupérez la dernière version du code source de CSSMatch :
 {{{
svn checkout http://cssmatch-plugin.googlecode.com/svn/trunk cssmatch-plugin-read-only
}}}
 Vous devriez maintenant avoir sous les yeux un dossier *hl2sdk-ob* et un dossier *cssmatch-plugin-read-only*, tous deux placés dans le dossier que vous avez créé au début de cette section.
 * Dans le dossier *cssmatch-plugin-read-only*, créez un lien symbolique nommé *bin* pointant sur le dossier *orangebox/bin* de SRCDS
 {{{
ln -s ~/srcds/orangebox/bin bin 
}}}
 (où *~/srcds* est à adapter en fonction de votre installation de SRCDS)

== Compilation ==
 * Placez-vous dans le dossier contenant le code source de CSSMatch (ex : *cssmatch-plugin-read-only*)
 * Lancez la compilation :
 {{{
make
}}} 
 _*Note :* Le makefile utilise *g++-4.1* pour compiler les sources. Adaptez le si nécessaire._

 Vous constaterez que de nombreux avertissements sont affichés. Hélas, c'est normal, et vous ne pourrez rien y changer. Ils proviennent du SDK fourni par Valve, mais ils sont inoffensifs.
 Pour évitez d'être noyé dans tous ces avertissements, vous pouvez rediriger les erreurs vers un fichier pour qu'elles ne s'affichent pas:
 {{{
make 2> debug_make.txt
}}}
 Les messages d'erreurs résultants de la compilation seront alors redirigés vers un fichier "debug_make.txt". Si la compilation échoue, vous pourrez alors afficher les messages d'erreur via cette commande :
 {{{
more debug_make.txt | grep "\(\(e|E\)rror\|\(e|E\)rreur\)"
}}}

 _*Note :* La compilation peut prendre quelques minutes, surtout si vous ne redirigez pas les avertissements._

 _*Note :* Le fichier *cssmatch.so* est généré dans le sous-dossier *zip/addons*._
 * Quelques cibles utiles du Makefile :
{{{
# Compiler en mode debug
make debug

# Nettoyer les dossiers de sortie (release et debug)
make clean
}}}

<br>
= Compilation sur Windows =

== Les pré-requis ==
 * Une version 32 bits récente de Windows (XP et Vista testés)
 * Un client SVN. (Je vous recommande [http://tortoisesvn.tigris.org/ TortoiseSVN].) Vous pouvez également installer le logiciel "svn" et l'utiliser en ligne de commande. Dans ce cas, reportez-vous aux lignes de commandes données dans la partie dédiée à Linux.
 * CSSMatch est un projet [http://developer.valvesoftware.com/wiki/Compiling_under_VS2005#Installing Visual C++ Express 2005] (logiciel gratuit). Cependant, vous avez aussi le choix entre [http://developer.valvesoftware.com/wiki/Category:Programming#Compiling Visual Studio 2005 ou 2008 (payant)] et [http://msdn.microsoft.com/fr-fr/express/aa975050.aspx Visual C++ Express 2008 (gratuit)]. Le projet (CSSMatch-2005.vcproj) sera alors automatiquement converti lors de sa première ouverture. 
 _*Note :* Par ailleurs, vous pouvez décider d'utiliser le compilateur de Visual Studio/C++ avec un IDE tel que [http://www.codeblocks.org/ Code::Blocks]._

== Préparation de la première compilation ==
 * Commencez par créer un dossier pour le projet.
 * Si vous utilisez Visual C++ Express, vous devez télécharger et installer le SDK de Windows approprié :
  ** pour XP, Vista et probablement Seven : [http://www.microsoft.com/downloads/details.aspx?FamilyId=A55B6B43-E24F-4EA3-A93E-40C0EC4F68E5&displaylang=en Plateform SDK]
  ** pour Windows 2000 : [http://www.microsoft.com/downloads/details.aspx?FamilyId=A55B6B43-E24F-4EA3-A93E-40C0EC4F68E5&displaylang=en#filelist PSDK-x86.exe] + [http://www.01net.com/telecharger/windows/Programmation/creation/fiches/25232.html .NET Framework]
 * Placez-vous dans le dossier qui va contenir le projet
 * Récupérez le SDK des jeux _Source 2009 (alias Orange Box)_ compatible avec la version 4.1 de gcc : http://hg.alliedmods.net/hl2sdks/hl2sdk-ob-valve/archive/tip.zip (38 MB)
 _*Note :* Pour éviter d'avoir à modifier les options du projet Visual C++, arrangez-vous pour que le dossier contenant le SDK soit nommé *hl2sdk-ob*._ 
 * Récupérez la dernière version du code source de CSSMatch. (Avec TortoiseSVN : clique-droit > "SVN Checkout" sur le lien http://cssmatch-plugin.googlecode.com/svn/trunk dans le dossier de votre choix)
 Vous devriez maintenant avoir sous les yeux un dossier *hl2sdk-ob* et un dossier *cssmatch-plugin-read-only*, tous deux placés dans le dossier que vous avez créé au début de cette section.

== Compilation ==
 * Placez-vous dans le dossier contenant le code source de CSSMatch
 * Ouvrez le fichier projet CSSMatch en double-cliquant sur le fichier *CSSMatch-2005.vcproj* (ou *CSSMatch-2005.sln*)
 * Lancez une génération (menu "Générér" > "Générer en tâche de fond..." > cocher "Release")
 _*Note :* Le fichier *cssmatch.dll* est généré dans le sous-dossier *zip/addons*._

<br>
= Notes communes à la compilation sur Linux et Windows =
 * Le fichier *cssmatch.vdf* est un fichier texte qui n'est pas généré par le processus de compilation. (Ouvrez le ! Il indique au serveur quel fichier charger.)

 * Pour synchroniser votre version locale du code source avec celle disponible sur Google Code :
  # Placez-vous dans le dossier contenant les fichiers du projets (cssmatch-plugin-read-only par exemple)
  # Exécutez :
{{{
svn update
}}}
 (Avec TortoiseSVN : clique-droit, "SVN Update".) <br><br>
 _*Note :* Vous pouvez vous tenir au courant de l'activité du dépôt SVN en vous abonnant à la liste de diffusion [http://groups.google.com/group/cssmatch-repository]_